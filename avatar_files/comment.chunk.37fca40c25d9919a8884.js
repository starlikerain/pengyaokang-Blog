bundleJsonp([4],{246:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),i=n.n(o),r=n(1),a=n(511),c=n(31),u=n(78),d=n(497),l=n(498),s=n(500),m=n(501),f=n(27);n.d(e,"setup",function(){return C}),n.d(e,"showComment",function(){return k});var p,_,h,v,b,g,y,x,w;b="pixivComment",g=1,p=null,v=null;var C=function(){var t,e,n;p=i()("._comment-items"),v=i()("._no-item",p),n=i()(".stamp-form"),n.length&&n.html(a.default.template("stamp-tab-content",{stamp_series:r.a.context.stampSeries})),e=i()(".emoji-list"),e.length&&e.html(a.default.template("emoji-list",{emoji_series:r.a.context.emojiSeries})),f.c.update(),a.default.d.on("submit","._comment-form",y).on("click","._comment-form .sticker",x).on("click",".more-comment",h).on("click",".delete-comment",_).on("click",".reply",function(t){w(i()(t.currentTarget).closest("._comment-item, .sticker-item"))}).on("click",".reply-to",function(t){k(i()(t.currentTarget).dataset("id"))}).on("click",".comment .date",function(t){return a.default.query.replace({comment_id:i()(this).closest("._comment-item").dataset("id")},!0,!1),!1}),(t=r.a.context.queries.comment_id)&&k(t)};y=function(t){var e,n,o,u,l;return u=i()(t.currentTarget),!u.hasClass("sending")&&(n=u.closest("._comment-form"),l=n.find("textarea"),!!(e=i.a.trim(l.val()))&&(u.addClass("sending"),o="illust"===r.a.context.type?d.a:s.a,o(r.a.context.illustId,r.a.context.userId,e,n.dataset("parentCommentId")).always(function(){u.removeClass("sending")}).done(function(t){l.val(""),v.addClass("_hidden"),u=i()(t.body.html).hide().prependTo(p).slideDown("fast"),c.a.update(),a.default.d.trigger(b+"Post",[u])}).fail(function(t,e,n){window.alert(n)}),!1))},x=function(t){var e,n,o,u;return u=i()(t.currentTarget),o=u.parents(".tab-content-sticker"),!o.hasClass("sending")&&(e=u.closest("._comment-form"),o.addClass("sending"),o.find(".disabler .bar").animate({width:"0%"},1e4,"linear"),n="illust"===r.a.context.type?l.a:m.a,n(r.a.context.illustId,r.a.context.userId,u.dataset("id"),e.dataset("parentCommentId")).always(function(){window.setTimeout(function(){return o.removeClass("sending"),o.find(".disabler .bar").css("width","100%")},1e4)}).done(function(t){v.addClass("_hidden"),i()(t.body.html).hide().prependTo(p).slideDown("fast"),c.a.update(),a.default.d.trigger(b+"Sticker",[u])}).fail(function(t,e,n){window.alert(n)}),!1)},_=function(t){var e,n,o;return o=i()(t.currentTarget),!(o.hasClass("sending")||!window.confirm(o.dataset("textConfirm")))&&(e=o.closest("._comment-item, .sticker-item"),o.addClass("sending"),n="illust"===r.a.context.type?d.b:s.b,n(r.a.context.illustId,e.dataset("id")).always(function(){o.removeClass("sending")}).done(function(){var t;t=function(){e.remove(),i()("._comment-item, .sticker-item",p).length||v.removeClass("_hidden")},e.hasClass("sticker-item")?e.animate({width:0},"fast",t):e.slideUp("fast",t)}).fail(function(t,e,n){return window.alert(n)}),!1)},h=function(t){var e,n;return n=i()(this),!n.hasClass("loading")&&(n.addClass("loading"),e="illust"===r.a.context.type?d.c:s.c,e(r.a.context.illustId,r.a.context.userId,++g).always(function(){return n.removeClass("loading")}).done(function(e){return n=i()(e.body.html).appendTo("._comment-items"),e.body.more||i()(t.target).remove(),c.a.update(),a.default.d.trigger(b+"More",[n])}).fail(function(t,e,n){return window.alert(n)}),!1)};var k=function(t,e){var o,l,m;null==t&&(t=void 0),null==e&&(e=!1),l=i()("._comment-form-container"),l.length&&(t?(m="illust"===r.a.context.type?d.d:s.d,m(t,e).done(function(t){w(t.body.html)}).fail(function(){})):(o=i()("._comment-modal"),i()(".content",o).html(l.first().clone()),window.setTimeout(function(){return i()("textarea",o).focus()}),o.on("uimodalclose",function(){return a.default.d.off(".reply")}),a.default.ui.modal.push(o,{block:!0}),a.default.d.on("pixivCommentPost.reply pixivCommentSticker.reply",function(){return a.default.ui.modal.pop(),n.i(u.b)({type:"success",text:"コメントしました",link:"#one_comment"})}),i()(".ui-tab-container.root",o).each(function(){return f.c.restore(this)}),c.a.update()))};w=function(t){var e,o;t=i()(t),e=i()("._comment-modal"),o=i()(".user-name",t).text(),i()(".body p",t).html(u.a.replace(i()(".body p",t).html())),i()(".content",e).html(i()("._comment-form-container").first().clone()).find("._comment-form").dataset("parentCommentId",t.dataset("id")||"").end().prepend(t.clone()),window.setTimeout(function(){i()("textarea",e)[0].focus()}),e.on("uimodalclose",function(){a.default.d.off(".reply")}),a.default.ui.modal.push(e,{block:!0}),a.default.d.on("pixivCommentPost.reply pixivCommentSticker.reply",function(){return a.default.ui.modal.pop(),n.i(u.b)({type:"success",text:"コメントしました",link:"#one_comment"})}),i()(".ui-tab-container.root",e).each(function(){return f.c.restore(this)}),c.a.update()}},497:function(t,e,n){"use strict";var o=n(10);n.d(e,"d",function(){return i}),n.d(e,"a",function(){return r}),n.d(e,"c",function(){return a}),n.d(e,"b",function(){return c});var i=function(t,e){return o.a("/rpc/get_comment.php",{comment_id:t,mode:e?"all":null})},r=function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return o.b("/rpc/post_comment.php",{type:"comment",illust_id:t,author_user_id:e,comment:n,parent_id:i})},a=function(t,e,n){return o.b("/rpc_comment_history.php",{i_id:t,u_id:e,p:n})},c=function(t,e){return o.b("/rpc_delete_comment.php",{i_id:t,del_id:e})}},498:function(t,e,n){"use strict";var o=n(10);n.d(e,"a",function(){return i});var i=function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return o.b("/rpc/post_comment.php",{type:"stamp",illust_id:t,author_user_id:e,stamp_id:n,parent_id:i})}},500:function(t,e,n){"use strict";var o=n(10);n.d(e,"d",function(){return i}),n.d(e,"a",function(){return r}),n.d(e,"c",function(){return a}),n.d(e,"b",function(){return c});var i=function(t,e){return o.a("/novel/rpc/get_comment.php",{comment_id:t,mode:e?"all":null})},r=function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return o.b("/novel/rpc/post_comment.php",{type:"comment",novel_id:t,author_user_id:e,comment:n,parent_id:i})},a=function(t,e,n){return o.b("/novel/rpc_comment_history.php",{i_id:t,u_id:e,p:n})},c=function(t,e){return o.b("/novel/rpc_delete_comment.php",{i_id:t,del_id:e})}},501:function(t,e,n){"use strict";var o=n(10);n.d(e,"a",function(){return i});var i=function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return o.b("/novel/rpc/post_comment.php",{type:"stamp",novel_id:t,author_user_id:e,stamp_id:n,parent_id:i})}}});